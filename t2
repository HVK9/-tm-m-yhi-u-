--[[
    HVK9 AUTOMATION V26 - GOD MODE
    1. UI: Màn hình tối, HUD đơn giản (Level/Money).
    2. AUTO START: Tự chạy ngay khi Execute.
    3. AUTO STATS: Tự cộng Melee & Defense.
    4. PERSISTENCE: Tự nạp lại khi qua Sea (Sea Hop).
]]

-- --- CƠ CHẾ TỰ NẠP LẠI KHI QUA SEA (Auto Execute Logic) ---
if (not game:IsLoaded()) then game.Loaded:Wait() end
pcall(function()
    if queue_on_teleport then
        queue_on_teleport('loadstring(game:HttpGet("https://raw.githubusercontent.com/USER/REPO/main/script.lua"))()') 
        -- Lưu ý: Dòng trên là ví dụ, tốt nhất bạn nên để file này vào thư mục autoexec
    end
end)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local VirtualUser = game:GetService("VirtualUser")

local LocalPlayer = Players.LocalPlayer

-- --- CẤU HÌNH TỰ ĐỘNG (KHÔNG CẦN CHỈNH) ---
local CONFIG = {
    AutoFarmLevel = true,      -- MẶC ĐỊNH BẬT
    AutoSeaHop = true,         -- MẶC ĐỊNH BẬT
    AutoStats = true,          -- MẶC ĐỊNH BẬT
    WeaponType = "Melee",      -- Dùng Melee để farm
    
    FlySpeed = 320,            
    HoverHeight = 15,          
    FastAttackDelay = 0.1,
    ScanRadius = 400
}

-- Biến theo dõi tiền
local StartMoney = LocalPlayer.Data.Beli.Value
local MoneyEarned = 0

-- --- ANTI AFK ---
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- --- UI DARK MODE & HUD ---
if CoreGui:FindFirstChild("HVK9_Overlay") then CoreGui.HVK9_Overlay:Destroy() end
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HVK9_Overlay"
ScreenGui.Parent = CoreGui
ScreenGui.IgnoreGuiInset = true -- Che toàn màn hình kể cả thanh topbar

-- 1. Lớp phủ tối màn hình
local DarkOverlay = Instance.new("Frame")
DarkOverlay.Size = UDim2.new(1, 0, 1, 0)
DarkOverlay.BackgroundColor3 = Color3.new(0, 0, 0)
DarkOverlay.BackgroundTransparency = 0.3 -- Độ tối (0.3 là khá tối)
DarkOverlay.Parent = ScreenGui
DarkOverlay.Active = false -- Để vẫn click được vào game nếu cần

-- 2. Logo HVK9 (Giữa trên)
local Logo = Instance.new("TextLabel")
Logo.Size = UDim2.new(0, 200, 0, 50)
Logo.Position = UDim2.new(0.5, -100, 0.05, 0) -- Canh giữa
Logo.BackgroundTransparency = 1
Logo.Text = "HVK-9"
Logo.TextColor3 = Color3.fromRGB(0, 255, 100) -- Màu xanh neon
Logo.Font = Enum.Font.FredokaOne
Logo.TextSize = 40
Logo.Parent = ScreenGui

-- Hiệu ứng nhấp nháy cho Logo
task.spawn(function()
    while true do
        TweenService:Create(Logo, TweenInfo.new(1), {TextTransparency = 0.5}):Play()
        task.wait(1)
        TweenService:Create(Logo, TweenInfo.new(1), {TextTransparency = 0}):Play()
        task.wait(1)
    end
end)

-- 3. HUD Thông tin (Bên phải)
local StatsFrame = Instance.new("Frame")
StatsFrame.Size = UDim2.new(0, 200, 0, 100)
StatsFrame.Position = UDim2.new(1, -220, 0.5, -50) -- Bên phải giữa
StatsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
StatsFrame.BackgroundTransparency = 0.5
StatsFrame.Parent = ScreenGui
local UICorner = Instance.new("UICorner", StatsFrame); UICorner.CornerRadius = UDim.new(0, 10)

local LevelLabel = Instance.new("TextLabel")
LevelLabel.Size = UDim2.new(1, 0, 0.5, 0)
LevelLabel.Position = UDim2.new(0, 0, 0, 0)
LevelLabel.BackgroundTransparency = 1
LevelLabel.Text = "Level: " .. LocalPlayer.Data.Level.Value
LevelLabel.TextColor3 = Color3.new(1, 1, 1)
LevelLabel.Font = Enum.Font.SourceSansBold
LevelLabel.TextSize = 24
LevelLabel.Parent = StatsFrame

local MoneyLabel = Instance.new("TextLabel")
MoneyLabel.Size = UDim2.new(1, 0, 0.5, 0)
MoneyLabel.Position = UDim2.new(0, 0, 0.5, 0)
MoneyLabel.BackgroundTransparency = 1
MoneyLabel.Text = "Earned: +$0"
MoneyLabel.TextColor3 = Color3.fromRGB(255, 215, 0) -- Màu vàng
MoneyLabel.Font = Enum.Font.SourceSansBold
MoneyLabel.TextSize = 24
MoneyLabel.Parent = StatsFrame

-- Loop cập nhật HUD
task.spawn(function()
    while true do
        task.wait(1)
        if LocalPlayer and LocalPlayer:FindFirstChild("Data") then
            LevelLabel.Text = "Level: " .. LocalPlayer.Data.Level.Value
            local currentMoney = LocalPlayer.Data.Beli.Value
            MoneyEarned = currentMoney - StartMoney
            MoneyLabel.Text = "Earned: +$" .. MoneyEarned
        end
    end
end)

-- --- AUTO STATS (CỘNG ĐIỂM) ---
-- Cộng Melee và Defense
task.spawn(function()
    while true do
        task.wait(0.5)
        if CONFIG.AutoStats then
            pcall(function()
                local points = LocalPlayer.Data.Points.Value
                if points > 0 then
                    -- Cộng vào Melee (Dùng remote AddPoint)
                    local args1 = { "AddPoint", "Melee", 1 }
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args1))
                    
                    -- Cộng vào Defense
                    local args2 = { "AddPoint", "Defense", 1 }
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args2))
                end
            end)
        end
    end
end)

-- --- AUTO HAKI ---
task.spawn(function()
    while true do
        task.wait(2)
        pcall(function()
            if LocalPlayer.Character and not LocalPlayer.Character:FindFirstChild("HasBuso") then
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("Buso")
            end
        end)
    end
end)

-- --- HỆ THỐNG NHẬN DIỆN SEA ---
local CurrentSea = 1
local PlaceId = game.PlaceId
if PlaceId == 2753915549 then CurrentSea = 1
elseif PlaceId == 4442272183 then CurrentSea = 2
elseif PlaceId == 7449423635 then CurrentSea = 3
end

-- --- DATABASE NHIỆM VỤ (GIỮ NGUYÊN) ---
local DB = {
    Sea1 = {
        {Req = 0, Name = "Bandit", QName = "BanditQuest1", QId = 1, NpcPos = Vector3.new(1060, 16, 1547), MobPos = Vector3.new(1150, 16, 1600)},
        {Req = 10, Name = "Monkey", QName = "JungleQuest", QId = 1, NpcPos = Vector3.new(-1598, 36, 153), MobPos = Vector3.new(-1400, 30, 50)},
        {Req = 15, Name = "Gorilla", QName = "JungleQuest", QId = 2, NpcPos = Vector3.new(-1598, 36, 153), MobPos = Vector3.new(-1200, 10, -500)},
        {Req = 30, Name = "Pirate", QName = "BuggyQuest1", QId = 1, NpcPos = Vector3.new(-1140, 4, 3827), MobPos = Vector3.new(-1200, 10, 3900)},
        {Req = 60, Name = "Desert Bandit", QName = "DesertQuest", QId = 1, NpcPos = Vector3.new(897, 6, 4387), MobPos = Vector3.new(950, 10, 4450)},
        {Req = 90, Name = "Snow Bandit", QName = "SnowQuest", QId = 1, NpcPos = Vector3.new(1386, 87, -1296), MobPos = Vector3.new(1350, 90, -1350)},
        {Req = 120, Name = "Chief Petty Officer", QName = "MarineQuest2", QId = 1, NpcPos = Vector3.new(-5039, 27, 4323), MobPos = Vector3.new(-4900, 30, 4200)},
        {Req = 150, Name = "Sky Bandit", QName = "SkyQuest", QId = 1, NpcPos = Vector3.new(-4842, 717, -2622), MobPos = Vector3.new(-4950, 280, -2900)},
        {Req = 190, Name = "Prisoner", QName = "PrisonerQuest", QId = 1, NpcPos = Vector3.new(5306, 1, 477), MobPos = Vector3.new(5100, 5, 500)},
        {Req = 225, Name = "Toga Warrior", QName = "ColosseumQuest", QId = 1, NpcPos = Vector3.new(-1575, 7, -2984), MobPos = Vector3.new(-1400, 10, -2800)},
        {Req = 300, Name = "Military Soldier", QName = "MagmaQuest", QId = 1, NpcPos = Vector3.new(-5314, 12, 8515), MobPos = Vector3.new(-5400, 20, 8600)},
        {Req = 375, Name = "Fishman Warrior", QName = "FishmanQuest", QId = 1, NpcPos = Vector3.new(6112, 18, 1569), MobPos = Vector3.new(6000, 50, 1400)},
        {Req = 450, Name = "God's Guard", QName = "SkyQuest", QId = 1, NpcPos = Vector3.new(-4842, 717, -2622), MobPos = Vector3.new(-4700, 550, -2000)},
        {Req = 525, Name = "Royal Squad", QName = "SkyQuest", QId = 2, NpcPos = Vector3.new(-7906, 5541, -1412), MobPos = Vector3.new(-7800, 5600, -1450)},
        {Req = 625, Name = "Galley Pirate", QName = "FountainQuest", QId = 1, NpcPos = Vector3.new(5259, 38, 4050), MobPos = Vector3.new(5600, 50, 4000)},
    },
    Sea2 = {
        {Req = 700, Name = "Raider", QName = "Area1Quest", QId = 1, NpcPos = Vector3.new(-429, 72, 1836), MobPos = Vector3.new(-480, 72, 1860)},
        {Req = 775, Name = "Swan Pirate", QName = "Area1Quest", QId = 2, NpcPos = Vector3.new(-429, 72, 1836), MobPos = Vector3.new(870, 120, 1200)},
        {Req = 875, Name = "Marine Lieutenant", QName = "MarineQuest3", QId = 1, NpcPos = Vector3.new(-2440, 72, -2788), MobPos = Vector3.new(-2000, 70, -2600)},
        {Req = 950, Name = "Zombie", QName = "ZombieQuest", QId = 1, NpcPos = Vector3.new(-5492, 48, -795), MobPos = Vector3.new(-5500, 10, -50)},
        {Req = 1000, Name = "Snow Trooper", QName = "SnowQuest", QId = 1, NpcPos = Vector3.new(609, 401, -1491), MobPos = Vector3.new(700, 400, -1300)},
        {Req = 1100, Name = "Lab Subordinate", QName = "IceSideQuest", QId = 1, NpcPos = Vector3.new(-6064, 15, -8352), MobPos = Vector3.new(-5800, 15, -8300)},
        {Req = 1175, Name = "Magma Ninja", QName = "FireSideQuest", QId = 1, NpcPos = Vector3.new(-5428, 15, -8515), MobPos = Vector3.new(-5400, 15, -8300)},
        {Req = 1250, Name = "Ship Deckhand", QName = "ShipQuest1", QId = 1, NpcPos = Vector3.new(1038, 125, 32913), MobPos = Vector3.new(920, 125, 32800)},
        {Req = 1350, Name = "Arctic Warrior", QName = "FrostQuest", QId = 1, NpcPos = Vector3.new(5667, 28, -6486), MobPos = Vector3.new(6000, 28, -6000)},
        {Req = 1425, Name = "Sea Soldier", QName = "ForgottenQuest", QId = 1, NpcPos = Vector3.new(-3054, 235, -10142), MobPos = Vector3.new(-3000, 240, -10000)},
        {Req = 1450, Name = "Water Fighter", QName = "ForgottenQuest", QId = 2, NpcPos = Vector3.new(-3054, 235, -10142), MobPos = Vector3.new(-3400, 240, -10500)},
    },
    Sea3 = {
        {Req = 1500, Name = "Pirate Millionaire", QName = "PiratePortQuest", QId = 1, NpcPos = Vector3.new(-290, 44, 5584), MobPos = Vector3.new(-300, 50, 5500)},
        {Req = 1575, Name = "Dragon Crew Warrior", QName = "AmazonQuest", QId = 1, NpcPos = Vector3.new(5832, 51, -1106), MobPos = Vector3.new(6300, 50, -1000)},
        {Req = 1700, Name = "Marine Commodore", QName = "MarineTreeIsland", QId = 1, NpcPos = Vector3.new(2181, 29, -6741), MobPos = Vector3.new(2450, 70, -7350)},
        {Req = 1775, Name = "Fishman Raider", QName = "DeepForestIsland3", QId = 1, NpcPos = Vector3.new(-10581, 332, -8761), MobPos = Vector3.new(-10400, 330, -8400)},
        {Req = 1800, Name = "Fishman Captain", QName = "DeepForestIsland3", QId = 2, NpcPos = Vector3.new(-10581, 332, -8761), MobPos = Vector3.new(-10800, 330, -8600)},
        {Req = 1975, Name = "Reborn Skeleton", QName = "HauntedQuest1", QId = 1, NpcPos = Vector3.new(-9482, 142, 5567), MobPos = Vector3.new(-8800, 140, 5900)},
        {Req = 2075, Name = "Peanut Scout", QName = "NutsIslandQuest", QId = 1, NpcPos = Vector3.new(-2104, 38, -10192), MobPos = Vector3.new(-2000, 70, -12500)},
        {Req = 2200, Name = "Cookie Crafter", QName = "IceCreamIslandQuest", QId = 1, NpcPos = Vector3.new(-818, 66, -16117), MobPos = Vector3.new(-2000, 70, -11500)},
        {Req = 2300, Name = "Cocoa Warrior", QName = "ChocQuest1", QId = 1, NpcPos = Vector3.new(231, 23, -12194), MobPos = Vector3.new(200, 50, -12200)},
        {Req = 2400, Name = "Candy Pirate", QName = "CandyQuest1", QId = 1, NpcPos = Vector3.new(-1148, 13, -14445), MobPos = Vector3.new(-1800, 40, -14500)},
        {Req = 2575, Name = "Shark Hunter", QName = "SharkHunterQuest", QId = 1, NpcPos = Vector3.new(-16500, 20, 2000), MobPos = Vector3.new(-17000, 20, 2000)},
        {Req = 2725, Name = "Isle Champion", QName = "TikiQuest2", QId = 1, NpcPos = Vector3.new(-16200, 20, 1000), MobPos = Vector3.new(-16400, 137, 1100)},
    }
}

-- --- HÀM LOGIC FARM ---
local function EquipWeapon()
    pcall(function()
        local char = LocalPlayer.Character
        if not char then return end
        local hum = char:FindFirstChild("Humanoid")
        local backpack = LocalPlayer.Backpack
        local current = char:FindFirstChildOfClass("Tool")
        if not current or current.ToolTip ~= CONFIG.WeaponType then
            for _, tool in pairs(backpack:GetChildren()) do
                if tool:IsA("Tool") and tool.ToolTip == CONFIG.WeaponType then
                    hum:EquipTool(tool)
                    break
                end
            end
        end
    end)
end

local function SmartMove(targetPos)
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local bv = hrp:FindFirstChild("HVK_Fly") or Instance.new("BodyVelocity", hrp)
    bv.Name = "HVK_Fly"
    bv.Velocity = Vector3.zero
    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)

    local dist = (hrp.Position - targetPos).Magnitude
    if dist < 20 then
        hrp.CFrame = CFrame.new(targetPos)
        return
    end

    local speed = CONFIG.FlySpeed
    local tweenInfo = TweenInfo.new(dist / speed, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(targetPos)})
    tween:Play()
end

local function DoFastAttack()
    local Net = ReplicatedStorage.Modules.Net
    local RegAttack = Net["RE/RegisterAttack"]
    local RegHit = Net["RE/RegisterHit"]
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local validEnemies = {}
    local mainTarget = nil
    for _, v in pairs(Workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
            local dist = (v.HumanoidRootPart.Position - hrp.Position).Magnitude
            if dist < 60 then
                table.insert(validEnemies, {v, v.HumanoidRootPart})
                mainTarget = v.HumanoidRootPart
            end
        end
    end
    if mainTarget then
        RegAttack:FireServer(0)
        RegHit:FireServer(mainTarget, validEnemies)
    end
end

local function GetQuestData()
    local myLevel = LocalPlayer.Data.Level.Value
    local dataTable = {}
    if CurrentSea == 1 then dataTable = DB.Sea1
    elseif CurrentSea == 2 then dataTable = DB.Sea2
    elseif CurrentSea == 3 then dataTable = DB.Sea3 end
    local best = dataTable[1]
    for _, q in ipairs(dataTable) do
        if myLevel >= q.Req then best = q end
    end
    return best
end

local function HasActiveQuest()
    local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if playerGui and playerGui:FindFirstChild("Main") and playerGui.Main:FindFirstChild("Quest") then
        return playerGui.Main.Quest.Visible
    end
    return false
end

local function FindMob(name)
    local hrp = LocalPlayer.Character.HumanoidRootPart
    local closest, dist = nil, 9e9
    for _, v in pairs(Workspace.Enemies:GetChildren()) do
        if v.Name == name and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            local d = (v.HumanoidRootPart.Position - hrp.Position).Magnitude
            if d < dist then dist = d; closest = v end
        end
    end
    return closest
end

-- --- LOGIC CHUYỂN SEA ---
local function HandleSeaHop()
    if not CONFIG.AutoSeaHop then return end
    local myLevel = LocalPlayer.Data.Level.Value
    if CurrentSea == 1 and myLevel >= 700 then
        local IceAdmiral = FindMob("Ice Admiral")
        if IceAdmiral then SmartMove(IceAdmiral.HumanoidRootPart.Position + Vector3.new(0, 15, 0))
        else game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("TravelDressrosa") end
    end
    if CurrentSea == 2 and myLevel >= 1500 then
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("TravelZou")
    end
end

-- --- MAIN LOOP ---
RunService.RenderStepped:Connect(function()
    if CONFIG.AutoFarmLevel then
        local char = LocalPlayer.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        for _, v in pairs(char:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
        
        EquipWeapon()
        pcall(DoFastAttack)
        HandleSeaHop()

        local quest = GetQuestData()
        if not HasActiveQuest() then
            if (hrp.Position - quest.NpcPos).Magnitude > 10 then
                SmartMove(quest.NpcPos)
            else
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", quest.QName, quest.QId)
                task.wait(0.5)
            end
        else
            local mob = FindMob(quest.Name)
            if mob then
                SmartMove(mob.HumanoidRootPart.Position + Vector3.new(0, CONFIG.HoverHeight, 0))
            else
                SmartMove(quest.MobPos + Vector3.new(0, 50, 0))
            end
        end
    end
end)
