local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

-- --- CẤU HÌNH ---
local CONFIG = {
    AutoFarm = false, -- Nút này bật thì Fast Attack sẽ chạy theo
    SelectedMob = nil,
    TargetPosition = nil,
    WeaponType = "Melee",
    
    FlySpeed = 300,
    HoverHeight = 15,
}
local MOBS_DB = {
-- Boss đặc biệt
    {Name = "hiếu liếm", Level = "Lọ Đế Chí Tôn", Pos = Vector3.new(0, 0, 0)},
    {Name = "huy gay", Level = "Gay Ko Đối Thủ", Pos = Vector3.new(0, 0, 0)},
    {Name = "hải xesa", Level = "Đại cao bằng", Pos = Vector3.new(0, 0, 0)},
    {Name = "khôi bảy chỏ", Level = "goats đéo có wowcup", Pos = Vector3.new(0, 0, 0)},
    {Name = "hùng king", Level = "goats of king", Pos = Vector3.new(0, 0, 0)},
}

-- --- HỆ THỐNG UI ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HVK-9"
if pcall(function() ScreenGui.Parent = CoreGui end) then else ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

-- 1. Nút Mini Toggle
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "ToggleBtn"
ToggleBtn.Parent = ScreenGui
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleBtn.Position = UDim2.new(0.02, 0, 0.2, 0)
ToggleBtn.Size = UDim2.new(0, 40, 0, 40)
ToggleBtn.Text = "H-9"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.SourceSansBold
ToggleBtn.TextSize = 18
local UICornerBtn = Instance.new("UICorner")
UICornerBtn.CornerRadius = UDim.new(0, 8)
UICornerBtn.Parent = ToggleBtn

-- 2. Bảng Menu Chính
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 320, 0, 350)
MainFrame.Active = true

local UICornerFrame = Instance.new("UICorner")
UICornerFrame.CornerRadius = UDim.new(0, 10)
UICornerFrame.Parent = MainFrame

-- Tiêu đề (Draggable)
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TitleLabel.Size = UDim2.new(1, 0, 0, 40)
TitleLabel.Text = "HVK-9"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.FredokaOne
TitleLabel.TextSize = 20
local UICornerTitle = Instance.new("UICorner")
UICornerTitle.CornerRadius = UDim.new(0, 10)
UICornerTitle.Parent = TitleLabel

local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
TitleLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
    end
end)
TitleLabel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)

ToggleBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

-- 3. Nút Chức Năng
local WeaponBtn = Instance.new("TextButton")
WeaponBtn.Parent = MainFrame
WeaponBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
WeaponBtn.Position = UDim2.new(0.1, 0, 0.15, 0)
WeaponBtn.Size = UDim2.new(0.8, 0, 0, 40)
WeaponBtn.Text = "Vũ Khí: Melee"
WeaponBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
WeaponBtn.Font = Enum.Font.SourceSansBold
WeaponBtn.TextSize = 18

local weapons = {"Melee", "Blox Fruit", "Sword", "Gun"}
local weaponIndex = 1
WeaponBtn.MouseButton1Click:Connect(function()
    weaponIndex = weaponIndex + 1
    if weaponIndex > #weapons then weaponIndex = 1 end
    CONFIG.WeaponType = weapons[weaponIndex]
    WeaponBtn.Text = "Vũ Khí: " .. CONFIG.WeaponType
end)

local FarmBtn = Instance.new("TextButton")
FarmBtn.Parent = MainFrame
FarmBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
FarmBtn.Position = UDim2.new(0.1, 0, 0.3, 0)
FarmBtn.Size = UDim2.new(0.8, 0, 0, 50)
FarmBtn.Text = "AUTO FARM: OFF"
FarmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
FarmBtn.Font = Enum.Font.SourceSansBold
FarmBtn.TextSize = 20
FarmBtn.MouseButton1Click:Connect(function()
    CONFIG.AutoFarm = not CONFIG.AutoFarm
    if CONFIG.AutoFarm then
        FarmBtn.Text = "AUTO FARM: ON"
        FarmBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    else
        FarmBtn.Text = "AUTO FARM: OFF"
        FarmBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    end
end)

local MobListFrame = Instance.new("ScrollingFrame")
MobListFrame.Parent = MainFrame
MobListFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MobListFrame.Position = UDim2.new(0.1, 0, 0.5, 0)
MobListFrame.Size = UDim2.new(0.8, 0, 0.45, 0)
MobListFrame.CanvasSize = UDim2.new(0, 0, 0, #MOBS_DB * 35)
MobListFrame.ScrollBarThickness = 6
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = MobListFrame
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

for i, mob in ipairs(MOBS_DB) do
    local btn = Instance.new("TextButton")
    btn.Parent = MobListFrame
    btn.Size = UDim2.new(1, 0, 0, 35)
    btn.Text = mob.Name .. " (Lv." .. mob.Level .. ")"
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.fromRGB(220, 220, 220)
    btn.MouseButton1Click:Connect(function()
        CONFIG.SelectedMob = mob.Name
        CONFIG.TargetPosition = mob.Pos
        for _, b in pairs(MobListFrame:GetChildren()) do if b:IsA("TextButton") then b.BackgroundColor3 = Color3.fromRGB(50, 50, 50) end end
        btn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    end)
end

-- --- LOGIC HỆ THỐNG (CORE) ---

-- 1. FAST ATTACK MODULE (ĐÃ TÍCH HỢP VÀO AUTO FARM)
task.spawn(function()
    local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
    local RegisterAttack = Net:WaitForChild("RE/RegisterAttack")
    local RegisterHit = Net:WaitForChild("RE/RegisterHit")
    
    while true do
        task.wait(0.05) -- Tốc độ đánh siêu nhanh (có thể chỉnh xuống 0.01 nếu máy mạnh)
        
        -- Chỉ chạy khi AUTO FARM đang BẬT
        if CONFIG.AutoFarm then
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local hrp = char.HumanoidRootPart
                
                -- 1.1. Gửi lệnh chém (Animation)
                pcall(function()
                    RegisterAttack:FireServer(0)
                end)
                
                -- 1.2. Gửi lệnh gây dame (Hit) cho quái xung quanh
                for _, v in pairs(Workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                        -- Nếu quái ở gần (trong tầm đánh 60)
                        if (v.HumanoidRootPart.Position - hrp.Position).Magnitude < 60 then
                            pcall(function()
                                RegisterHit:FireServer(v.HumanoidRootPart, {v})
                            end)
                        end
                    end
                end
            end
        end
    end
end)
-- 2. Trang bị vũ khí
local function EquipWeapon()
    local char = LocalPlayer.Character
    if not char then return end
    local backpack = LocalPlayer.Backpack
    local currentTool = char:FindFirstChildOfClass("Tool")
    
    if currentTool and ((CONFIG.WeaponType == "Melee" and currentTool.ToolTip == "Melee") or (currentTool.ToolTip == CONFIG.WeaponType)) then return end

    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and (tool.ToolTip == CONFIG.WeaponType or (CONFIG.WeaponType == "Melee" and tool.ToolTip == "Melee")) then
            char.Humanoid:EquipTool(tool)
            break
        end
    end
end
-- 3. Bay (Tween)
local function TweenTo(targetPos)
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local dist = (hrp.Position - targetPos).Magnitude
    local time = dist / CONFIG.FlySpeed
    local tween = TweenService:Create(hrp, TweenInfo.new(time, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetPos)})
    tween:Play()
    
    local bv = hrp:FindFirstChild("AntiFall") or Instance.new("BodyVelocity", hrp)
    bv.Name = "AntiFall"
    bv.Velocity = Vector3.zero
    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    
    if dist < 50 then bv:Destroy(); tween:Cancel() end
end

-- 4. Main Loop Auto Farm
RunService.RenderStepped:Connect(function()
    if CONFIG.AutoFarm and CONFIG.TargetPosition then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            EquipWeapon()
            
            local targetMob = nil
            for _, v in pairs(Workspace.Enemies:GetChildren()) do
                if v.Name == CONFIG.SelectedMob and v:FindFirstChild("HumanoidRootPart") and v.Humanoid.Health > 0 then
                    if (v.HumanoidRootPart.Position - hrp.Position).Magnitude < 3000 then targetMob = v; break end
                end
            end

            if targetMob then
                -- Bay tới đầu quái
                local farmPos = targetMob.HumanoidRootPart.Position + Vector3.new(0, CONFIG.HoverHeight, 0)
                hrp.CFrame = CFrame.new(farmPos, targetMob.HumanoidRootPart.Position)
                
                -- Giữ vị trí
                if not hrp:FindFirstChild("BodyVelocity") then
                    local bv = Instance.new("BodyVelocity", hrp)
                    bv.Velocity = Vector3.zero
                    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
                end
                
                -- LƯU Ý: Fast Attack đã chạy tự động ở luồng task.spawn bên trên rồi
            else
                TweenTo(CONFIG.TargetPosition)
            end
        end
    else
        -- Dọn dẹp
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            if char.HumanoidRootPart:FindFirstChild("AntiFall") then char.HumanoidRootPart.AntiFall:Destroy() end
            if char.HumanoidRootPart:FindFirstChild("BodyVelocity") then char.HumanoidRootPart.BodyVelocity:Destroy() end
        end
    end
end)

StarterGui:SetCore("SendNotification", {Title = "HVK-9"; Text = "có gì cần hỗ trợ liên hệ 0896.XXX.XXX"; Duration = 5})
