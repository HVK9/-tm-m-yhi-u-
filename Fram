local Camera = workspace.CurrentCamera
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Holding = false

-- --- CẤU HÌNH (Đã chỉnh lại theo ý bạn) ---
_G.AimbotEnabled = true
_G.TeamCheck = true       -- BẬT: Không aim vào đồng đội (Arsenal dùng TeamColor)
_G.AimPart = "Head"       -- Phần cơ thể để aim
_G.Sensitivity = 0        -- Đã trả về 0: Khóa mục tiêu ngay lập tức (không bị trượt)

-- Cấu hình vòng tròn FOV
_G.CircleSides = 64
_G.CircleColor = Color3.fromRGB(255, 255, 255)
_G.CircleTransparency = 0.7
_G.CircleRadius = 80      -- Bán kính vòng tròn (như cũ)
_G.CircleFilled = false
_G.CircleVisible = true
_G.CircleThickness = 1

local FOVCircle = Drawing.new("Circle")
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
FOVCircle.Radius = _G.CircleRadius
FOVCircle.Filled = _G.CircleFilled
FOVCircle.Color = _G.CircleColor
FOVCircle.Visible = _G.CircleVisible
FOVCircle.Transparency = _G.CircleTransparency
FOVCircle.NumSides = _G.CircleSides
FOVCircle.Thickness = _G.CircleThickness

local function GetClosestPlayer()
	local MaximumDistance = _G.CircleRadius
	local Target = nil

	-- Lặp qua tất cả người chơi
	for _, v in next, Players:GetPlayers() do
		-- 1. Bỏ qua chính mình
		if v.Name == LocalPlayer.Name then continue end

		-- 2. LOGIC TEAM CHECK (SỬA LẠI CHO ARSENAL)
		-- Nếu đang bật TeamCheck VÀ Màu đội giống nhau -> Bỏ qua người này ngay lập tức
		if _G.TeamCheck == true and v.TeamColor == LocalPlayer.TeamColor then
			continue 
		end

		-- 3. Kiểm tra nhân vật còn sống không
		if v.Character ~= nil then
			local Character = v.Character
			local Humanoid = Character:FindFirstChild("Humanoid")
			local TargetPart = Character:FindFirstChild(_G.AimPart)

			-- Kiểm tra máu và phần cơ thể
			if Humanoid and Humanoid.Health > 0 and TargetPart then
				local ScreenPoint, OnScreen = Camera:WorldToViewportPoint(TargetPart.Position)

				-- Chỉ aim nếu mục tiêu nằm trong màn hình
				if OnScreen then
					local MouseLocation = UserInputService:GetMouseLocation()
					local VectorDistance = (Vector2.new(MouseLocation.X, MouseLocation.Y) - Vector2.new(ScreenPoint.X, ScreenPoint.Y)).Magnitude

					-- Kiểm tra khoảng cách so với tâm vòng tròn
					if VectorDistance < MaximumDistance then
						Target = TargetPart -- Lưu trực tiếp phần cơ thể (Head)
						MaximumDistance = VectorDistance
					end
				end
			end
		end
	end

	return Target
end

-- Xử lý input chuột phải
UserInputService.InputBegan:Connect(function(Input)
    if Input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)

UserInputService.InputEnded:Connect(function(Input)
    if Input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)

-- Vòng lặp chính
RunService.RenderStepped:Connect(function()
    -- Cập nhật vòng tròn FOV theo chuột
    FOVCircle.Position = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)
    FOVCircle.Radius = _G.CircleRadius
    FOVCircle.Filled = _G.CircleFilled
    FOVCircle.Color = _G.CircleColor
    FOVCircle.Visible = _G.CircleVisible
    FOVCircle.Transparency = _G.CircleTransparency
    FOVCircle.NumSides = _G.CircleSides
    FOVCircle.Thickness = _G.CircleThickness

    -- Logic Aim
    if Holding == true and _G.AimbotEnabled == true then
        local TargetPart = GetClosestPlayer()
        if TargetPart then
            -- Nếu Sensitivity = 0, khóa thẳng camera vào mục tiêu
            if _G.Sensitivity == 0 then
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, TargetPart.Position)
            else
                -- Nếu muốn mượt thì dùng Tween (nhưng bạn thích nhanh nên code trên sẽ chạy dòng if)
                TweenService:Create(Camera, TweenInfo.new(_G.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {CFrame = CFrame.new(Camera.CFrame.Position, TargetPart.Position)}):Play()
            end
        end
    end
end)
